<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Kohana-formo : Object-based form handling for Kohana 3" />

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="javascripts/marked.js"></script>
    <script type="text/javascript" src="javascripts/site.js"></script>

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/bootstrap.css">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Formo Basics</title>
  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">

 <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
		<div class="container">
		  <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </button>
		  <a class="brand" href="./index.html">
			  <img src="images/formo-logo.png" alt="Formo For Kohana" width="116" height="50">
		  </a>
		  <div class="nav-collapse collapse">
			<ul class="nav">
			  <li class="">
				<a href="./index.html">Home</a>
			  </li>
			  <li class="active">
				<a href="./form-basics.html">Form Basics</a>
			  </li>
			  <li class="">
				<a href="./validation.html">Validation</a>
			  </li>
			  <li class="">
				<a href="./blueprints.html">Blueprints</a>
			  </li>
			  <li class="">
				<a href="./orm.html">ORM</a>
			  </li>
			  <li class="">
				<a href="./files.html">Files</a>
			  </li>
			  <li class="">
				<a href="./examples.html">Examples</a>
			  </li>
			</ul>
		  </div>
		</div>
	  </div>
	</div>

<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>Form basics</h1>
    <p class="lead">Learn the Formo ropes.</p>
  </div>
</header>



  <div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#create"><i class="icon-chevron-right"></i> Create a form</a></li>
          <li><a href="#adding"><i class="icon-chevron-right"></i> Adding fields</a></li>
          <li><a href="#validation"><i class="icon-chevron-right"></i> Basic validation</a></li>
          <li><a href="#rendering"><i class="icon-chevron-right"></i> Rendering</a></li>
          <li><a href="#getting"><i class="icon-chevron-right"></i> Getting and setting</a></li>
          <li><a href="#merging"><i class="icon-chevron-right"></i> Merging stuff</a></li>
          <li><a href="#ordering"><i class="icon-chevron-right"></i> Ordering</a></li>
          <li><a href="#subforms"><i class="icon-chevron-right"></i> Subforms</a></li>
          <li><a href="#resetting"><i class="icon-chevron-right"></i> Resetting</a></li>
          <li><a href="#drivers"><i class="icon-chevron-right"></i> Driver Descriptions</a></li>
          <li><a href="#helper-methods"><i class="icon-chevron-right"></i> HTML helper methods</a></li>
          <li><a href="#to-array"><i class="icon-chevron-right"></i> To Array</a></li>
          <li><a href="#config"><i class="icon-chevron-right"></i> Config settings</a></li>
          <li><a href="#terminology"><i class="icon-chevron-right"></i> Formo Terminology</a></li>
        </ul>
      </div>
      <div class="span9">



        <!-- Download
        ================================================== -->
        <a id="create" class="anchor"></a>
        <section>
          <div class="page-header">
            <h1>Create a form</h1>
          </div>

<div class="md">
To create a form, use `Formo::form()`:

```
$form = Formo::form();
```

You can also name your form by giving it an `alias`:

```
$form = Formo::form(['alias' => 'myform']);
```
</div> <!-- md -->
</section>

<a id="adding" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Adding fields</h1>
	</div>

<div class="md">
To add a field to the form, use `Formo::add()`. Here’s a practical example:

```
$Form = Formo::form()
	// The field added here is $form->first
	->add(‘first’)
	->add(‘last’, ‘input’)
	->add(‘email’, ‘input|email’)
	->add(‘notes’, ‘textarea’)
	->add(‘save’, ‘input|submit’, ‘Save’);
```

This will create the following:

1. Form object containing:
	1. input named ‘first’
	2. input named ‘last’
	3. input named ‘email’ with ‘type=“email”’ and validation rule that entered text is a valid email
	4. textare named ‘notes’
	5. input named ‘save’ with ‘type=“submit”’ and value ‘Save’

Every field has an `alias` that the field is accessible by. Also, by default, the field `name` is the same as its `alias` (if no name is specified).

The second parameter for `Formo::add()` is the field driver name. Drivers tell Formo how to process each field since different field types behave differently in HTML (think about ways a select field differs from a textarea, for instance).

Thus, when using `Formo::add()`, you specify:

1. The field alias
2. Driver name
3. Default value
4. Array of other attributes and options

## Field creation with an array

Though `Formo::add()` supports separate parameters that define the new field added to its parent, you can also pass an array as a field construct. Here's an example:

```
$form->add([
	'alias' => 'first_name',
	'driver' => 'input',
	'val' => NULL,
	'rules' => [
		['not_empty'],
	],
	'filters' => [
		function(str) {
			return trim($str);
		}
	],
]);
```

If array keys are not specified, Formo expects your array to be an exact representation of params for `Formo::add()`. Thus, the following three examples are equivelent.

```
$form->add('email', 'input|email', NULL, ['attr' => ['placeholder' => 'john@doe.com']]);

$form->add([
	'email',
	'input|email',
	NULL,
	['attr' => [
		'placeholder' => 'john@doe.com',
	]]
]);

$form->add([
	'alias' => 'email',
	'driver' => 'input|email',
	'val' => NULL,
	'attr' => [
		'placeholder' => 'john@doe.com',
	]
]);
```

</div> <!-- md -->
</section>
		<a id="validation" class="anchor"></a>
        <section>
          <div class="page-header">
            <h1>Basic Validation</h1>
          </div>

<div class="md">
For more detailed instructions on validation, see the [full validation documentation](./validation).
### Loading posted

The `Formo::load()` method tells the form that whatever array is passed as a parameter is what was posted. If no parameter is specified, Formo will use `Request::$current->post()` as the posted array.

### Validation

To validate your form, use `Formo::validate()`. This returns `TRUE` or `FALSE` whether the form passed validation rules or not.

Here’s a practical validation example:

```
if ($form->load()->validate())
{

}
```

What this is saying is, if the form loaded with `Request::$current->post()` passed validation rules attached to the form.
</div> <!-- md -->
</section>

<a id="rendering" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Rendering the form</h1>
	</div>

<div class="md">
To render your form using the built-in html templates, use `Formo::render()`:

```
echo $formo->render();
```

Note that a `Formo` object's `__toString()` method also runs `$form->render()`.

```
echo $form;
```

There are three variables Formo uses to decide which view file to use as a field's template:

- `template_dir`
- `template`
- `template_ext`

The default `template_dir` is defined in the Formo config.php file.

The `template` variable is defined per-driver (and can also be customized per field or form). When the field renders, Formo finds a view file named `$template_dir/$template`.

The `template_ext` is defined in the Formo config.php file, and can optionally add an extension to the template filenames.  This is in addition to the extension Kohana adds, defined by the `EXT` constant (typically `php`).  By default this is set to FALSE, so Formo will search for template filenames like `form_template.php`.  If set to `html`, for example, it will search for filenames like `form_template.html.php`.
</div> <!-- md -->
</section>

<a id="getting" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Getting and setting stuff</h1>
	</div>

<div class="md">
## Setting stuff

In a Formo object, you cannot directly access object properties except for fields. So, if you have a form object with a `first_name` field and want to set its label (which is the `$form->_label` protected property), you have to use the `Formo::set()` method.

It’s simple. Do `$form->set($property_name, $value)`:

```
$form->first_name->set(‘label’, ‘First Name’);
```

You can also set an array of stuff. When you pass an array of stuff, you need to specify the alias for each group of values you are setting.

```
$form->set([
	‘first_name’ => [
		‘label’ => ‘First Name’,
	],
	‘last_name’ => [
		‘label’ => ‘Last Name’,
	],
]);
```

## Setting extra variables

You can set any variable to any form object whenever you need. Let’s say you have a special variable named `$foo` you need to pass into your form. No problem:

```
$form->first_name->set(‘foo’, $bar);
```

## Setting the value

You can set a field's value two ways

```
$form->val($new_val);
$form->set('val', $new_val);

$form->add([
	‘alias’ => ‘foo’,
	‘val’ => $value,
]);
```

## Setting using array path

One awesome thing you can do is directly set a property inside an array using Kohana’s `Arr::path` method.

In this example, I am setting a custom config parameter for `label_message_file` for a particular form.

```
$form = Formo::form()
	->set(‘config.label_message_file’, $new_file);
```

That sets `$form->_config['label_message_file'] = $new_file`.

## Setting stuff for a bunch of fields at once.

Use `Formo::set_fields()` for setting variables for a bunch of fields at once.

Note that `Formo::set_fields()` does not throw an exception if a field doesn't exist in the form object. It is intended to be used in general setup methods to define a bunch of defaults, like in <a href="./orm.html">`Model::formo()`</a> for instance.

```
$form->set_fields([
	'email' => [
		'driver' => 'input|email',
		'rules' => [
			['unique_email']
		],
		'attr.placeholder' => 'john@doe.com',
	],
	'foo' => [
		'driver' => 'select',
		'rules' [
			['bar', ':model']
		],
		'attr.placeholder' => 'foobar',
		'attr.class' => 'myclass',
	].
]);
```

By default, `Formo::set_fields()` does not recursively look for fields to set options across. You can search recursively by passing `FALSE` as the second parameter:

```
$form->set_fields([
	'email' => [
		'driver' => 'input|email',
		'rules' => [
			['unique_email']
		],
		'attr.placeholder' => 'john@doe.com',
	],
	'foo' => [
		'driver' => 'select',
		'rules' [
			['bar', ':model']
		],
		'attr.placeholder' => 'foobar',
		'attr.class' => 'myclass',
	].
], FALSE);
```

You can set for all fields using the `*` syntax:

```
$form->set_fields([
	'*' => [
		'attr.class' => 'form-control'
	]
]);
```

## Getting stuff

**The only properties you can access directly in a Formo object are fields.** Thus, if you have a field named `first_name` and want to retrieve the `Formo::$_label` variable, you cannot use `$form->first_name->_label`. Instead you need to use `Formo::get()`.

`Formo::get($property, [$default = null])` takes two parameters:

1. The property you are retrieving
2. The default value if the property isn’t found.

## Retrieving custom variables

You retrieve custom variables the same as any others. Let’s say you passed a `$foo` variable into the `first_name` field:

```
$form->first_name->set(‘foo’, $bar);

$foo_value = $form->first_name->get(‘foo’);
```

That’s it.

## Getting the value

You can set a field's value two ways

```
$value = $form->val();
$value = $form->get('val');
```

## Getting using array path

Formo lets you get a property using Kohana’s `Arr::path()` method.

Here’s an example of retrieving `$form->_config[‘label_message_file’]` (which is a protected property) in one fell swoop:

```
$file = $form->get(‘config.label_message_file’);
```
</div> <!-- md -->
</section>

<a id="merging" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Merging Stuff</h1>
	</div> <!-- page-header -->
<div class="md">
Sometimes you don’t want to just set a variable value, but rather you need to merge an array of values with a new array of values.

For instance, a field’s filters are an array of filters inside a field.

Let’s say I created a form from a model, but I want to add a new filter to the bunch.

It’s dirt-simple using `Formo::merge()`.

```
$user = ORM::factory(‘User’, $id);
$other_email_filters = [
	‘remove_fugly_chars’,
];

$form = $user->get_form();

$form->email
	->merge(‘filters’, $other_email_filters);
```

You can also pass an array of stuff into `Formo::merge_fields()` and merge all sorts of stuff at once.

```
$form->merge_fields([
	‘:self’ => [
		‘config’ => $new_config_values,
	],
	‘email’ => [
		‘filters’ => $new_filters,
		‘rules’ => $new_rules,
		‘callbacks’ => $new_callbacks,
	],
	‘first_name’ => [
		‘rules’ => $new_rules,
	],
	‘hobbies’ => [
		‘opts’ => $new_opts,
	],
]);
```
</div> <!-- md -->
</section>

<a id="ordering" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Ordering</h1>
	</div>

<div class="md">
Use `Formo::order()` to reorder field and subform elements. The arguments:

- Field alias
- New order (`int`, `'before'`, or `'after'`)
- Relative field (default `NULL`)

If you know the numeric order the field should be in, leave the relative field param empty and specify the direct order of the field (starting with 0).

```
$form
	->add('confirm_password')
	->add('password')
	->add('last_name')
	->add('first_name');

$form->order([
	'first_name' => [0],
	'password' => ['after', 'first_name'],
	'last_name' => ['before', 'password'],
]);

$form->order('confirm_password', 'after', 'password');

// The order of fields afterwords
// 'first_name', 'last_name', 'password', 'confirm_password'
```

</div> <!-- md -->
</section>

<a id="subforms" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Subforms</h1>
	</div>

<div class="md">
A subform is a form within a form.

Formo supports deep form objects and allows as many forms to exist within other forms as you deem necessary.

Only the parent-most form will have the `form` driver. Others added to it will be converted to `group` by default.

## How to add a subform

Since a subform is just a form within a form, it's creation is just like a form. Then it's added to a parent form

```
$address = Formo::form(['alias' => 'address'])
	->add('street')
	->add('city')
	->add('zip');
 
$user_form = Formo::form()
	->add('first name')
	->add('last name')
	->add($address);
```

In the example above, the address form is added to $user_form after last_name. It is given the alias address and is using the driver group to handle it.

If you wanted to access street, to set its value for instance, you could do this:

```
$user_form->address->street->val();
```

Additionally, since PHP passes objects by reference, you could access the same value from the orinal subform object too:

```
$address->street->val();
```

## Subforms and validation

Subforms can still validate separately from the rest of the form.

```
$form->add($subform);

if ($form->load()->validate())
{

}
elseif ($form->subform->validate())
{

}
```

## Create a subform on the fly from existing fields

You may want to namespace a part of your form or simply turn a few fields into a subform on the fly. There are many reasons you may want to do this, but one is to allow the "group" or other specific driver for formatting reasons.

Doing this always appends your subform to the bottom of its parent.

To do this, use `Formo::subform()`. The arguments are:

- Group alias
- Fields to add to group (array)
- Order for new subform to be placed (array, default `NULL`)
- Subform's driver (default `group`)

```
$form = Formo::form()
	->add('username')
	->add('email')
	->add('password')
	->add('street')
	->add('city')
	->add('state');
 
$form->subform('address', ['street', 'city', 'state'], ['before', 'username']);
```

You can also specify a numeric order for the subform

```
$form->subform('address', ['street', 'city', 'state'], [1]);
```

</div> <!-- md -->
</section>

<a id="resetting" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Resetting</h1>
	</div>

<div class="md">
You can reset any form or field's values using the `Formo::reset()` method.

This recursively resets any field values within the field also.

```
// Reset entire form's values recursively
$form->reset();

// Reset individual field
$form->first_name->reset();
```


</div> <!-- md -->
</section>

<a id="drivers" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Driver Descriptions</h1>
	</div>

<div class="md">
Formo fields use static **drivers** to handle all field-specific functionality. Here is a list of the default drivers that ship with Formo.

### Form driver

Forms begin and end with a `<form>` tag. There can only be one Formo object with a `form` driver inside a Formo object. Thus subforms are converted by default to the `group` driver when added to a form as a subform.

A field with the `form` driver is returned from `Formo::form()`.

### Input driver

The input driver is the default Formo field driver. If you add a field without a driver specified, it will be a field with the `input` driver.

Since **input** is used for so many types of field in HTML, Formo allows a short syntax for specifying an `input` field with a special `type` tag. Don't use these with types `checkbox` or `radio` as they function much different from regular `input type=text` fields.

### Group driver

Used for subforms. The `group` acts like the `form` driver without the opening and closing form tags.

### Button driver

Used for `<button>`

Don't forget to set the field's `html` that goes inside the `<button>` tags.

### Checkbox driver

For single `<input type="checkbox" />`

### Checkboxes driver

For multiple checkboxes

### Datalist driver

Used for HTML5 datalists

### File driver

For file uploads

### Radio driver

For single `<input type="radio" />`

### Radios driver

For multiple radios

### Select driver

For select dropdowns

### Textarea driver

For textarea fields

</div> <!-- md -->
</section>

<a id="helper-methods" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>HTML helper methods</h1>
	</div> <!-- page-header -->
	
<div class="md">
Form and field objects have HTML helper methods that make working with objects as html simpler.

### add_class()

Add a class or classes to a field/form object

```
$form->add_class('new-class');

$form->add_class('new-class1 new-class2');

$form->add_class(['new-class1', 'new-class2']);
```

### attr()

Get or set html tag attribute

```
$field->attr('placeholder', 'john@doe.com');

$field->attr([
	'placeholder' => 'john@doe.com',
	'disabled' => true,
	'style' => 'width: 300px',
]);

$placeholder = $field->attr('placeholder');
```

### attr_fields()

Set attributes for a set of fields

```
$form->attr_fields([
	'email' => [
		'placeholder' => 'john@doe.com',
	],
	'first_name' => [
		'disabled' => true',
		'style' => 'background: purple',
	],
]);
```

### close();

Return the field's closing tag

```
echo $form->close();
```

### html()

Get or set HTML part of the tag

```
$button->html('Click me to submit');

$html = $button->html();
```

### label()

Get field's label

```
$label = $field->label();
```

### name()

Return a field's HTML 'name' tag value

```
$name = $field->name();
```

### open()

Return a field's HTML opening tag

```
echo $form->open();
```


### remove_class()

Remove class or classes from a field/form object

$form->removeClass('foo');

$form->removeClass('foo1 foo2');

$form->removeClass(['foo1', 'foo2']);
```

</div> <!-- md -->

</section>

<a id="to-array" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>To Array</h1>
	</div> <!-- page-header -->

<div class="md">
Formo gives a convenient way to convert your form and field definitions to an array, recursively.

You can use this to pass around entire form definitions that you can use to create entirely new forms, send
to your client, or whatever you want.

To cast a form to an array, use `Formo::to_array()`:

```
$array = $form->to_array();
```

You can do the same thing for just a field or subform:

```
$array1 = $form->email->to_array();

$array2 = $form->my_subform->to_array();
```

You can also specify which attributes you want to pull out of each object:

```
$array = $form->to_array(['alias', 'driver', 'rules', 'val']);
```
</div>
</section>

<a id="config" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Config settings</h1>
	</div> <!-- page-header -->

<div class="md">
## How Formo looks for the config setting

For flexibility, when Formo retrieves a config setting, it follows this pattern looking for the setting:

1. Field itself
2. Field's parent
3. Inside the Formo `config.php` file

Here's a rather complicated example:

```
$form = Formo::form()
	->add('first_name', 'input', NULL, ['label_message_file' => 'mymessages2']);

$form2 = Formo::form([
	'alias' => 'form2',
	'label_message_file' => 'mymessages3',
])
->add('last_name', 'input', NULL, ['label_message_file' => FALSE])
->add('middle_initial', 'input', NULL);

$form->add($form2);
```

Based on the form definition above, here are what each field would use for its label messages file:

```
$form - Kohana::$config->load('formo.label_message_file');
$form->first_name - mymessages2
$form2 - 'mymessages3'
$form2->last_name - FALSE
$form2->middle_initial - 'mymessages3'
```

## Config setting explanations

<table>
	<thead>
		<tr>
			<th>Variable</th>
			<th>Explanation</th>
		</tr>
	</thead>
	<tbody>

		<tr>
			<td>`label_message_file`</td>
			<td>The file used for label messages. You can set this to `FALSE` to not use Kohana messages at all.</td>
		</tr>

		<tr>
			<td>`validation_message_file`</td>
			<td>The file used for Kohana validation messages.</td>
		</tr>

		<tr>
			<td>`translate`</td>
			<td>Set to `TRUE` or `FALSE` whether to run labels and errors through Kohana's translation `__()` function.</td>
		</tr>

		<tr>
			<td>`close_single_html_tags`</td>
			<td>Set to `TRUE` or `FALSE` whether to add a closing `/` to single tags. For instance, when `TRUE`, you would get `<input type="text" />` and set to `FALSE` you get the HTML 5 styled `<input type="text">`</td>
		</tr>

		<tr>
			<td>`auto_id`</td>
			<td>Set to `TRUE` or `FALSE` whether fields should that don't have manually specified `ID` tags set will auto-generate them.</td>
		</tr>

		<tr>
			<td>`template_dir`</td>
			<td>The directory to look for template view files</td>
		</tr>

		<tr>
			<td>`namespaces`</td>
			<td>Boolean setting whether to namespace field names. For example `<input type="text" name="parent_alias[field_alias]" />`</td>
		</tr>

		<tr>
			<td>`orm_driver`</td>
			<td>The driver to use for your ORM</td>
		</tr>

		<tr>
			<td>`model_base_rules`</td>
			<td>When using ORM driver, whether to automatically add mysql field base rules to formo field</td>
		</tr>

		<tr>
			<td>`input_rules`</td>
			<td>These are pre-defined rules that get added to `input` elements with HTML 5 `type` attributes that are supposed to have built-in validation. These pre-defined rules are supposed to mimic those that are built into the browser with these type tags.</td>
		</tr>

	</tbody>

</table>


</div> <!-- md -->
</section>

<a id="terminology" class="anchor"></a>
<section>
	<div class="page-header">
		<h1>Formo Terminology</h1>
	</div>

<div class="md">
While using Formo, it's important to understand Formo's terminology.

### Field

A field is a form field attached to a form. You attach fields using `Formo::add()`. Fields are accessed directly from its form.

In this example, `email` is the field's alias, and it can be accessed as `$form->email`.

```
$form->add('email', 'input|email');
```

### Driver

The driver handles field-specific functionality. For instance, a `checkbox` field functions totally different from an `input type="text"` field.

Formo drivers handle every field-specific function from setting the value correctly to getting the field's label.

In this example, the driver is `select`, and a `select` driver requires an extra array of `opts` (options).

```
$form->add('hobbies', 'select', NULL, ['opts' => $options]);
```

### Subform

A group of fields added to a form.

In this example, `$f2` is the subform.

```
$form = Formo::form();

$f2 = Formo::form(['alias' => 'mysubform']);

$form->add($f2);
```

### Rules

Rules are validation rules

### Filters

Filters are run on field values before validation

</div> <!-- md -->
</section>


	<div style="height:40px"></div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'formo'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

      </div>
    </div>

  </div>


  </body>
</html>
